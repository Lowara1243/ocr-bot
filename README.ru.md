[English](README.md) | [Русский](README.ru.md)

---

# Telegram OCR Бот

Telegram-бот, который использует Tesseract или Yandex Vision для распознавания текста на изображениях.

## Содержание
- [Особенности](#особенности)
- [Быстрый запуск (Docker Compose)](#быстрый-запуск-docker-compose)
- [Установка из исходного кода](#установка-из-исходного-кода)
- [Конфигурация](#конфигурация)
- [Управление ботом](#управление-ботом)

## Особенности
- Распознает текст с изображений, отправленных в виде фотографий.
- **Несколько OCR-движков:** Поддерживает локальную обработку с помощью **Tesseract** и облачную через **Yandex Vision**.
- **Постоянное хранилище:** Использует SQLite для хранения пользовательских данных и настроек.
- **Гибкая система лимитов:** Настраиваемые дневные, недельные и месячные лимиты на использование.
- **Готов к развертыванию:** Оптимизирован для легкого запуска с помощью Docker Compose / Podman Compose.

## Быстрый запуск (Docker Compose)
Это рекомендуемый способ для запуска бота.

1.  Создайте новую директорию для вашего бота.
2.  Создайте в этой директории файл `docker-compose.yml` со следующим содержимым:
    ```yaml
    version: '3.8'

    services:
      ocr-bot:
        image: lowara1243/ocr-bot:1.0
        container_name: telegram_ocr_bot
        restart: always
        env_file:
          - .env
        volumes:
          - ./database:/app/database
          - ./logs:/app/logs
          - ./temp_images:/app/temp_images
        tty: true
    ```
3.  **Настройте бота.** Как минимум, вам нужно создать файл `.env` и указать ваш `BOT_TOKEN`. Полное руководство и список всех переменных смотрите в разделе [Конфигурация](#конфигурация).
4.  Запустите бота:
    ```bash
    docker-compose up -d
    ```
5.  Бот запустится и подключится к Telegram, используя ваш токен.

## Установка из исходного кода
<details>
<summary>Нажмите, чтобы развернуть инструкцию по ручной установке</summary>

1.  **Клонируйте репозиторий**
    ```bash
    git clone https://github.com/Lowara1243/ocr-bot.git
    cd ocr-bot
    ```
2.  **Создайте виртуальное окружение и установите зависимости**
    - Используя `uv` (рекомендуется):
        ```bash
        uv pip install -r requirements.txt
        ```
    - Используя стандартный `pip`:
        ```bash
        python -m venv .venv
        source .venv/bin/activate     # Для Windows используйте: .venv\Scripts\activate
        pip install -r requirements.txt
        ```
3.  **Настройте бота.** Создайте файл `.env`, укажите ваш `BOT_TOKEN` и другие необходимые переменные. Подробности — в разделе [Конфигурация](#конфигурация).
4.  **Запустите бота**
    ```bash
    python main.py
    ```
    </details>

## Конфигурация
Для настройки бота создайте файл `.env` в корневой директории проекта. Проще всего скопировать файл с примером:

```bash
cp .env.example .env
```

Затем откройте `.env` в вашем редакторе и измените настройки.

| Переменная                | Описание                                                                     | Обязательно |
|:--------------------------|:-----------------------------------------------------------------------------|:-----------:|
| `BOT_TOKEN`               | Ваш Telegram-бот токен от [@BotFather](https://t.me/BotFather).              |   **Да**    |
| `ADMIN_ID`                | Ваш Telegram User ID (администратор не имеет лимитов).                       |     Нет     |
| `DEFAULT_OCR_ENGINE`      | Движок OCR по умолчанию (`tesseract` или `yandex`).                          |     Нет     |
| `ENABLED_OCR_ENGINES`     | Список включенных движков через запятую (например, `tesseract,yandex`).      |     Нет     |
| `YANDEX_CLOUD_API_KEY`    | API-ключ для Yandex Cloud Vision API.                                        |     Нет     |
| `YANDEX_CLOUD_FOLDER_ID`  | ID каталога в Yandex Cloud для Vision API.                                   |     Нет     |
| `RATE_LIMIT_DAILY`        | Суточный лимит запросов (целое число).                                       |     Нет     |
| `RATE_LIMIT_WEEKLY`       | Недельный лимит запросов (целое число).                                      |     Нет     |
| `RATE_LIMIT_MONTHLY`      | Месячный лимит запросов (целое число).                                       |     Нет     |
| `LOG_LEVEL`               | Уровень логирования: `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`.        |     Нет     |
| `LOG_FILE`                | Путь к файлу логов (оставьте пустым для вывода только в консоль).            |     Нет     |
| `DATABASE_PATH`           | Путь к файлу базы данных SQLite (например, `database/ocr_bot.db`).           |     Нет     |
| `TESSERACT_CMD_PATH`      | Полный путь к исполняемому файлу `tesseract`, если он не в системном `PATH`. |     Нет     |
| `DEFAULT_OCR_LANGUAGE`    | Язык OCR по умолчанию (`eng`, `rus`, `eng+rus` и т.п.).                      |     Нет     |
| `SUPPORTED_OCR_LANGUAGES` | Поддерживаемые языки через запятую (для Tesseract).                          |     Нет     |
| `OCR_LOG_PREVIEW_LENGTH`  | Длина предпросмотра распознанного текста в логах (в символах).               |     Нет     |

## Управление ботом
- **Просмотр логов:**  
  ```bash
  docker-compose logs -f
  ```

- **Остановка бота:**
  ```bash
  docker-compose down
  ```

- **Перезапуск бота:**
  ```bash
  docker-compose restart
  ```